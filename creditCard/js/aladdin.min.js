/*! Aladdin.js v1.0.6 (c) 2017 Aladdin */
!function (t, e) {
    "object" == typeof exports && "undefined" != typeof module ? module.exports = e() : "function" == typeof define && define.amd ? define(e) : t.aladdin = e()
}(this, function () {
    "use strict";
    function t(t, e, n) {
        Object.defineProperty(t, e, {value: n, writable: !1})
    }

    function e(t) {
        var e = function (e) {
            e && this.emit("error", e), t && "function" == typeof t && t.apply(null, arguments)
        }.bind(this);
        return e.keep = t.keep, e
    }

    function n() {
        this._ts = (new Date).getTime(), this._counter = 0, this._handlers = {}, this._subscribers = {}, this._middlewares = [], this._datas = {}
    }

    function i(t, e) {
        if (void 0 === e && (e = !1), !t || "object" != typeof t)return "";
        var n = [];
        for (var i in t) {
            var o = t[i];
            if (Array.isArray(o))for (var r in o)n.push((e ? i : i + "[]") + "=" + encodeURIComponent(o[r])); else n.push(i + "=" + encodeURIComponent(o))
        }
        return n.join("&")
    }

    function o(t, e, n) {
        void 0 === n && (n = !1);
        var o = i(e, n);
        return "" !== o && (o = (/\?/.test(t) ? "&" : "?") + o), t + o
    }

    function r(t) {
        this._aladdin = t
    }

    function s(t) {
        var e = this;
        for (var n in t)e[n] = t[n]
    }

    function a(t) {
        return function (e, n) {
            t(e, new s(n))
        }
    }

    function c(t) {
        return t = t || {}, t.method = t.method.toLowerCase() || "get", t.headers || (t.headers = {}), "post" !== t.method && "put" !== t.method && "patch" !== t.method && "delete" !== t.method || t.headers["Content-Type"] || (t.headers["Content-Type"] = "application/x-www-form-urlencoded"), t.qs && "[object Object]" === Object.prototype.toString.call(t.qs) && (t.url = o(t.url, t.qs, t.traditional)), t.body && "[object Object]" === Object.prototype.toString.call(t.body) && (/x-www-form-urlencoded/.test(t.headers["Content-Type"]) ? t.body = i(t.body, t.traditional) : t.body = JSON.stringify(t.body)), t
    }

    function u(t) {
        this._aladdin = t
    }

    function d(t) {
        this._aladdin = t
    }

    function l(t) {
        d.call(this, t)
    }

    function p(t) {
        d.call(this, t)
    }

    function h(t) {
        this._aladdin = t
    }

    function f(t) {
        this._aladdin = t
    }

    function y(t) {
        this._aladdin = t
    }

    function m(t) {
        this._aladdin = t
    }

    function _(t) {
        this._aladdin = t
    }

    var b, v, g, w = function (t) {
        if (t.env.isBrowser)try {
            var e = JSON.parse(sessionStorage.getItem("aladdinChromeExtensionInfo"));
            e && (sessionStorage.removeItem("aladdinChromeExtensionInfo"), e.activeRequire ? window.aladdinChromeExtension && window.aladdinChromeExtension.startListen(t) : "complete" !== document.readyState && document.write('<script src="' + e.injectScriptPath + '"></script>'))
        } catch (t) {
            console.log("Browser plug-in loading failure")
        }
        window.__ALADDIN_CALLBACK__ = function () {
            var e = arguments;
            setTimeout(function () {
                t.callback.apply(t, e)
            }, 0)
        }, window.__ALADDIN_EVENT_EMIT__ = function () {
            var e = arguments;
            setTimeout(function () {
                t.emit.apply(t, e)
            }, 0)
        }, window.__ALADDIN_FETCH__ = function (e) {
            return t.fetch(e)
        }
    }, I = navigator.userAgent, A = /AladdinHybrid\/(\d+\.\d+\.?\d*.*?) \((.*?) (\d+\.\d+\.?\d*.*?)\)/i.exec(I);
    Array.isArray(A) && (b = A[1], v = A[2], g = A[3]);
    var C = {
        hybridVersion: b,
        appName: v,
        appVersion: g,
        isMobile: /Mobile/i.test(I),
        isAndroid: /Android/i.test(I),
        isiOS: !!I.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/i),
        isiPhone: /iPhone/i.test(I),
        isiPad: /iPad/i.test(I),
        isiPod: /iPod/i.test(I),
        isHybrid: !!b,
        isBrowser: !b,
        isWechat: /MicroMessenger/i.test(I),
        isQQ: / QQ\//i.test(I)
    }, S = "aladdin:";
    t(n.prototype, "version", "1.0.6"), n.prototype.on = function (t, e) {
        return t && "string" == typeof t && e && "function" == typeof e ? ((this._subscribers[t] || (this._subscribers[t] = [])).push(e), this) : this
    }, n.prototype.once = function (t, e) {
        var n = this, i = function () {
            n.off(t, i), e.apply(this, arguments)
        };
        return i.listener = e, this.on(t, i), this
    }, n.prototype.off = function (t, e) {
        var n = this;
        if (!arguments.length) {
            for (t in this._subscribers)delete n._subscribers[t];
            return this
        }
        if (!t || "string" != typeof t)return this;
        if (!e && this._subscribers[t])return delete this._subscribers[t], this;
        var i = this._subscribers[t];
        if (!i)return this;
        for (var o, r = i.length; r--;)if (o = i[r], o === e || o.listener === e) {
            n._subscribers[t].splice(r, 1);
            break
        }
        return this
    }, n.prototype.emit = function (t) {
        for (var e = [], n = arguments.length - 1; n-- > 0;)e[n] = arguments[n + 1];
        if (t && "string" == typeof t) {
            var i = this._subscribers[t];
            if (i)for (var o in i)i[o].apply(null, e)
        }
        return this
    }, n.prototype.broadcast = function (t, e, n, i) {
        if (!t)return this;
        "function" == typeof e ? (i = e, e = {}) : "function" == typeof n && (i = n, n = "");
        var o = {eventName: t, event: e, url: n};
        return this.call("aladdin", "broadcast", o, i), this
    }, n.prototype.use = function (t) {
        if ("function" == typeof t) {
            var e = new t(this), n = e.name || t.name.replace(/^([A-Z])/, function (t) {
                    return t.toLowerCase()
                });
            if (!n)throw new Error("The Component's name is required");
            this[n] = e
        }
        return this
    }, n.prototype.middleware = function (t) {
        return "function" == typeof t && this._middlewares.push(t), this
    }, n.prototype.support = function (t, e, n) {
        if (!t)return this;
        "function" == typeof e && (n = e, e = "");
        var i = {component: t, action: e};
        return this.call("aladdin", "support", i, n), this
    }, n.prototype._transformHandlers = function (t, n, i, o) {
        var r = this;
        for (var s in i) {
            var a = i[s];
            if (a) {
                var c = Object.prototype.toString.call(a);
                if ("[object Object]" !== c && "[object Array]" !== c || r._transformHandlers(t, n, a, o), "[object Function]" === c) {
                    var u = o + "_function_" + t + "_" + n + "_" + (isNaN(s) ? s : "callback");
                    i[s] = u, r._handlers[u] = e.call(r, a)
                }
            }
        }
    }, n.prototype.call = function (t, e) {
        for (var n = [], i = arguments.length - 2; i-- > 0;)n[i] = arguments[i + 2];
        var o = {component: t, action: e, args: n, callId: (this._ts + ++this._counter).toString(16)};
        if (this._middlewares.length > 0 && (o = this._middlewares.reduce(function (t, e) {
                return e(t)
            }, o), !o))return this;
        this._transformHandlers(o.component, o.action, o.args, o.callId), o.message = o.component + "." + o.action + "?" + encodeURIComponent(JSON.stringify(o.args)), o.url = S + "//" + o.message, this.emit("call", o);
        var r;
        if (C.isAndroid)r = prompt(o.url); else if (C.isiOS) {
            o.message.length > 1024 && (this._datas[o.callId] = o.message, o.url = S + "//delay-fetch?callId=" + o.callId), window.__ALADDIN__ || (window.__ALADDIN__ = {});
            var s = document.createElement("IFRAME");
            s.setAttribute("src", o.url), s.setAttribute("style", "display: none;"), document.documentElement.appendChild(s), s.parentNode.removeChild(s), s = null, r = window.__ALADDIN__.retValue, window.__ALADDIN__.retValue = void 0
        }
        return r
    }, n.prototype.callback = function (t) {
        for (var e = [], n = arguments.length - 1; n-- > 0;)e[n] = arguments[n + 1];
        if (t) {
            var i = this._handlers[t];
            this.emit("callback", {
                handlerKey: t,
                handler: i,
                args: e
            }), i && "function" == typeof i && (i.apply(null, e), i.keep || delete this._handlers[t])
        }
    }, n.prototype.fetch = function (t) {
        var e = this._datas[t];
        return e && delete this._datas[t], e
    }, t(r.prototype, "name", "navigator"), r.prototype.forward = function (t, e) {
        return t = t || {}, t.url = t.url || "", t.transition = t.transition || "pushFromRight", t.qs && "object" == typeof t.qs && (t.url = o(t.url, t.qs, t.traditional)), this._aladdin.call(this.name, "forward", t, e), this
    }, r.prototype.back = function (t, e) {
        return t = t || {}, "function" == typeof t && (e = t, t = {}), this._aladdin.call(this.name, "back", t, e), this
    }, r.prototype.backTop = function (t, e) {
        return t = t || {}, "function" == typeof t && (e = t, t = {}), this._aladdin.call(this.name, "backTop", t, e), this
    }, s.prototype.json = function () {
        return this.body ? JSON.parse(this.body) : {}
    }, s.prototype.text = function () {
        return this.body
    }, s.prototype.header = function (t) {
        var e = this;
        if (t = t.toLowerCase(), !this.headers)return "";
        for (var n in this.headers)if (n.toLowerCase() === t)return e.headers[n];
        return ""
    }, t(u.prototype, "name", "http"), u.prototype.request = function (t, e) {
        return t = c(t), e = a(e), this._aladdin.call(this.name, "request", t, e), this
    }, u.prototype.setCookie = function (t, e) {
        return this._aladdin.call(this.name, "setCookie", t, e), this
    }, u.prototype.getCookie = function (t, e, n) {
        return this._aladdin.call(this.name, "getCookie", t, e, n), this
    }, u.prototype.removeCookie = function (t, e, n) {
        return this._aladdin.call(this.name, "removeCookie", t, e, n), this
    }, u.prototype.upload = function (t, e) {
        return t = t || {}, t.method = t.method || "post", t = c(t), this._aladdin.call(this.name, "upload", t, e), this
    }, u.prototype.download = function (t, e) {
        return t = c(t), this._aladdin.call(this.name, "download", t, e), this
    };
    var k = function (t, e) {
        function n() {
            this.constructor = t
        }

        for (var i in e)e.hasOwnProperty(i) && (t[i] = e[i]);
        t.prototype = null === e ? Object.create(e) : (n.prototype = e.prototype, new n)
    }, D = function (t) {
        return "string" != typeof t && ("[object Null]" === toString.call(t) || "undefined" == typeof t ? t += "" : t = t.toString()), t
    };
    d.prototype.getItem = function (t, e, n, i) {
        "function" == typeof e ? (i = e, e = !1, n = "3DES") : "function" == typeof n ? (e = !!e, i = n, n = "3DES") : (e = !!e, n = n || "3DES"), t = D(t);
        var o = {key: t, share: e, crypto: n};
        return this._aladdin.call(this.name, "getItem", o, function (t, e) {
            try {
                e = JSON.parse(e)
            } catch (t) {
                e = null
            }
            i(t, e)
        }), this
    }, d.prototype.setItem = function (t, e, n, i, o) {
        t = D(t), e = JSON.stringify(e), "function" == typeof n ? (o = n, n = !1, i = "3DES") : "function" == typeof i ? (n = !!n, o = i, i = "3DES") : (n = !!n, i = i || "3DES");
        var r = {key: t, value: e, share: n, crypto: i};
        return this._aladdin.call(this.name, "setItem", r, o), this
    }, d.prototype.removeItem = function (t, e, n) {
        t = D(t), "function" == typeof e && (n = e, e = !1);
        var i = {key: t, share: e};
        return this._aladdin.call(this.name, "removeItem", i, n), this
    }, d.prototype.clear = function (t) {
        return this._aladdin.call(this.name, "clear", t), this
    }, k(l, d), t(l.prototype, "name", "localStorage"), k(p, d), t(p.prototype, "name", "sessionStorage"), t(h.prototype, "name", "device"), h.prototype.getInfo = function (t) {
        return this._aladdin.call(this.name, "getInfo", t), this
    }, t(f.prototype, "name", "network"), f.prototype.getInfo = function (t) {
        return this._aladdin.call(this.name, "getInfo", t), this
    }, t(y.prototype, "name", "crypto"), y.prototype.encrypt = function (t, e) {
        return t = t || {}, this._aladdin.call(this.name, "encrypt", t, e), this
    }, y.prototype.decrypt = function (t, e) {
        return t = t || {}, this._aladdin.call(this.name, "decrypt", t, e), this
    }, t(m.prototype, "name", "header"), m.prototype.config = function (t, e) {
        return t = t || {}, this._aladdin.call(this.name, "config", t, e), this
    }, t(_.prototype, "name", "page"), _.prototype.bounce = function (t, e) {
        return this.config({bounce: !!t}, e), this
    }, _.prototype.swipe = function (t, e) {
        return this.config({swipe: !!t}, e), this
    }, _.prototype.config = function (t, e) {
        return t = t || {}, this._aladdin.call(this.name, "config", t, e), this
    };
    var j = new n;
    return j.env = C, j.use(r).use(u).use(h).use(f).use(y).use(m).use(l).use(p).use(_), w(j), j
});